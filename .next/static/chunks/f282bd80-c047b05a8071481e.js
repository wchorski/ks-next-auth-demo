"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[562],{6844:function(e,t,n){n.d(t,{c:function(){return createDocumentEditor}});var i=n(3428),r=n(8183),o=n(2265);n(6566);var l=n(7911),s=n(4043),a=n(5874);n(4368);var d=n(4588),c=n(1322);n(6483);var u=n(1219),p=n(8889);n(1761);var h=n(3526),f=n(6794);n(59);var m=n(2372);n(9171);var g=n(4851),y=n(1373);n(7110),n(7619),n(9244),n(7381),n(9278);var k=n(9459);n(6353),n(5691),n(8986);var v=n(6014),M=n(2286),N=n(5003),b=n(9533),C=n(4995);n(806);var x=n(5986),B=n.n(x),L=n(6049),w=n(7415),R=n(9264),Y=n(6933),E=n.n(Y);let paragraphElement=()=>({type:"paragraph",children:[{text:""}]});function areArraysEqual(e,t){return e.length===t.length&&e.every((e,n)=>e===t[n])}function normalizeTextBasedOnInlineMarksAndSoftBreaks([e,t],n,i,r){let o=Object.keys(e).filter(e=>"text"!==e&&"insertMenu"!==e&&!0!==i[e]);if(o.length)return l.YR.unsetNodes(n,o,{at:t}),!0;if(!r){let i=e.text.includes("\n");if(i){let[e]=l.ML.parent(n,t);if("code"!==e.type)for(let e of l.ML.positions(n,{at:t})){let t=l.NB.get(n,e.path).text[e.offset];if("\n"===t)return l.YR.delete(n,{at:e}),!0}}}return!1}function normalizeInlineBasedOnLinksAndRelationships([e,t],n,i,r,o){if("link"===e.type&&!i)return l.YR.insertText(n,` (${e.href})`,{at:l.ML.end(n,t)}),l.YR.unwrapNodes(n,{at:t}),!0;if("relationship"===e.type&&(!r||void 0===o[e.relationship])){let i=e.data;if(i){let r=o[e.relationship];l.YR.insertText(n,`${i.label||i.id||""} (${(null==r?void 0:r.label)||e.relationship}:${i.id||""})`,{at:l.ML.before(n,t)})}return l.YR.removeNodes(n,{at:t}),!0}return!1}function normalizeElementBasedOnDocumentFeatures([e,t],n,{formatting:i,dividers:r,layouts:o,links:s,relationships:a},d){return("heading"!==e.type||i.headingLevels.length&&i.headingLevels.includes(e.level))&&("ordered-list"!==e.type||i.listTypes.ordered)&&("unordered-list"!==e.type||i.listTypes.unordered)&&("code"!==e.type||i.blockTypes.code)&&("blockquote"!==e.type||i.blockTypes.blockquote)&&("layout"!==e.type||0!==o.length&&o.some(t=>areArraysEqual(t,e.layout)))?("paragraph"===e.type||"heading"===e.type)&&(!i.alignment.center&&"center"===e.textAlign||!i.alignment.end&&"end"===e.textAlign||"textAlign"in e&&"center"!==e.textAlign&&"end"!==e.textAlign)?(l.YR.unsetNodes(n,"textAlign",{at:t}),!0):"divider"!==e.type||r?normalizeInlineBasedOnLinksAndRelationships([e,t],n,s,a,d):(l.YR.removeNodes(n,{at:t}),!0):(l.YR.unwrapNodes(n,{at:t}),!0)}function getAncestorComponentBlock(e){if(e.selection){let t=l.ML.above(e,{match:t=>l.W_.isElement(t)&&l.ML.isBlock(e,t)&&"paragraph"!==t.type});if(t&&("component-block-prop"===t[0].type||"component-inline-prop"===t[0].type))return{isInside:!0,componentBlock:l.ML.parent(e,t[1]),prop:t}}return{isInside:!1}}let I=new WeakMap;function doesSchemaOnlyEverContainASingleChildField(e){let t=new Set([e]),n=!1;for(let e of t)if("form"===e.kind||"relationship"===e.kind);else if("child"===e.kind){if(n)return!1;n=!0}else if("array"===e.kind){if(function(e){let t=new Set([e]);for(let e of t)if("form"===e.kind||"relationship"===e.kind);else if("child"===e.kind)return!0;else if("array"===e.kind)t.add(e.element);else if("object"===e.kind)for(let n of Object.values(e.fields))t.add(n);else if("conditional"===e.kind)for(let n of Object.values(e.values))t.add(n);else(0,f.a)(e);return!1}(e.element))return!1}else if("object"===e.kind)for(let n of Object.values(e.fields))t.add(n);else if("conditional"===e.kind)for(let n of Object.values(e.values))t.add(n);else(0,f.a)(e);return n}let S=(0,o.createContext)([]);S.Provider,(0,r.tZ)(y.S,{size:"small"});let isListType=e=>"ordered-list"===e||"unordered-list"===e,isListNode=e=>isListType(e.type),T=(0,o.createContext)({});T.Provider;let P=o.createContext(null);function useToolbarState(){let e=(0,o.useContext)(P);if(!e)throw Error("ToolbarStateProvider must be used to use useToolbarState");return e}function getAncestorComponentChildFieldDocumentFeatures(e,t,n){let i=l.ML.above(e,{match:(0,h.nodeTypeMatcher)("component-block-prop","component-inline-prop")});if(i){let r=i[0].propPath,o=l.ML.parent(e,i[1]);if("component-block"===o[0].type){let e=o[0].component,i=n[e];if(i&&r){let e=(0,f.l)(r,o[0].props,i.schema);if((null==e?void 0:e.kind)==="child")return(0,f.e)(t,e.options)}}}}let isLinkActive=e=>(0,h.isElementActive)(e,"link"),wrapLink=(e,t)=>{if(isLinkActive(e)){l.YR.unwrapNodes(e,{match:e=>"link"===e.type});return}let{selection:n}=e,i=n&&l.e6.isCollapsed(n);i?l.YR.insertNodes(e,{type:"link",href:t,children:[{text:t}]}):l.YR.wrapNodes(e,{type:"link",href:t,children:[{text:""}]},{split:!0})};(0,r.tZ)(p.b,null),(0,r.tZ)(u.h,{size:"small"});let A=(0,r.tZ)(c.x,{size:"small"}),D=(0,o.forwardRef)(function(e,t){let{editor:n,links:{isDisabled:l,isSelected:s}}=useToolbarState();return(0,o.useMemo)(()=>(0,r.tZ)(p.a,(0,i.Z)({ref:t,isDisabled:l,isSelected:s,onMouseDown:e=>{e.preventDefault(),wrapLink(n,"")}},e),A),[s,l,n,e,t])});(0,r.tZ)(d.u,{content:"Link",weight:"subtle"},e=>(0,r.tZ)(D,e));let O=/(^|\s)\[(.+?)\]\((\S+)\)$/,insertBlockquote=e=>{let t=(0,h.isElementActive)(e,"blockquote");t?l.YR.unwrapNodes(e,{match:e=>"blockquote"===e.type}):l.YR.wrapNodes(e,{type:"blockquote",children:[]})};function getDirectBlockquoteParentFromSelection(e){if(!e.selection)return{isInside:!1};let[,t]=l.ML.parent(e,e.selection);if(!t.length)return{isInside:!1};let[n,i]=l.ML.parent(e,t),r="blockquote"===n.type;return r?{isInside:!0,path:i}:{isInside:!1}}let BlockquoteButton=({attrs:e})=>{let{editor:t,blockquote:{isDisabled:n,isSelected:l}}=useToolbarState();return(0,o.useMemo)(()=>(0,r.tZ)(p.a,(0,i.Z)({isSelected:l,isDisabled:n,onMouseDown:e=>{e.preventDefault(),insertBlockquote(t)}},e),(0,r.tZ)(QuoteIcon,null)),[t,e,n,l])};(0,r.tZ)(d.u,{content:(0,r.tZ)(o.Fragment,null,"Quote",(0,r.tZ)(p.K,null,"> ")),weight:"subtle"},e=>(0,r.tZ)(BlockquoteButton,{attrs:e}));let QuoteIcon=()=>(0,r.tZ)(IconBase,null,(0,r.tZ)("path",{d:"M11.3031 2C9.83843 2 8.64879 3.22321 8.64879 4.73171C8.64879 6.23928 9.83843 7.46342 11.3031 7.46342C13.8195 7.46342 12.3613 12.2071 9.18767 12.7012C9.03793 12.7239 8.90127 12.7995 8.80243 12.9143C8.70358 13.029 8.64908 13.1754 8.64879 13.3268C8.64879 13.7147 8.99561 14.0214 9.37973 13.9627C15.148 13.0881 17.1991 2.00093 11.3031 2.00093V2ZM3.65526 2C2.18871 2 1 3.22228 1 4.73171C1 6.23835 2.18871 7.46155 3.65526 7.46155C6.17067 7.46155 4.71252 12.2071 1.53888 12.7012C1.3893 12.7239 1.25277 12.7993 1.15394 12.9139C1.05511 13.0285 1.00051 13.1746 1 13.3259C1 13.7137 1.34682 14.0205 1.73001 13.9617C7.50016 13.0872 9.55128 2 3.65526 2Z"}));function CodeButton({attrs:e}){let{editor:t,code:{isDisabled:n,isSelected:s}}=useToolbarState();return(0,o.useMemo)(()=>(0,r.tZ)(p.a,(0,i.Z)({isSelected:s,isDisabled:n,onMouseDown:e=>{e.preventDefault(),s?l.YR.unwrapNodes(t,{match:e=>"code"===e.type}):l.YR.wrapNodes(t,{type:"code",children:[{text:""}]})}},e),(0,r.tZ)(v.d,{size:"small"})),[n,s,e,t])}(0,r.tZ)(d.u,{weight:"subtle",content:(0,r.tZ)(o.Fragment,null,"Code block ",(0,r.tZ)(p.K,null,"```"))},e=>(0,r.tZ)(CodeButton,{attrs:e})),(0,r.tZ)(M.x,{size:"small"}),(0,r.tZ)(b.U,{size:"small"}),(0,r.tZ)(N.m,{size:"small"}),(0,r.tZ)(k.v,{size:"small"});let z=o.createElement(C.V,{size:"small"});function insertDivider(e){(0,h.insertNodesButReplaceIfSelectionIsAtEmptyParagraphOrHeading)(e,{type:"divider",children:[{text:""}]}),l.ML.insertNode(e,{type:"paragraph",children:[{text:""}]})}let DividerButton=({attrs:e})=>{let{editor:t,dividers:{isDisabled:n}}=useToolbarState();return(0,o.useMemo)(()=>o.createElement(p.a,(0,i.Z)({isDisabled:n,onMouseDown:e=>{e.preventDefault(),insertDivider(t)}},e),z),[t,n,e])};d.u,o.Fragment,p.K,(0,r.tZ)(k.v,{size:"small"});let IconBase=e=>(0,r.tZ)("svg",(0,i.Z)({"aria-hidden":"true",fill:"currentColor",focusable:"false",height:"16",role:"presentation",viewBox:"0 0 16 16",width:"16"},e)),W={bold:["**","__"],italic:["*","_"],strikethrough:["~~"],code:["`"]},F=new WeakSet,q=new WeakSet;function removeInsertMenuMarkWhenOutsideOfSelection(e){var t;let n=function findPathWithInsertMenu(e,t){if(l.xv.isText(e))return e.insertMenu?t:void 0;if(!F.has(e.children)){for(let[n,i]of e.children.entries()){if(q.has(i))continue;let e=findPathWithInsertMenu(i,[...t,n]);if(e)return e;q.add(i)}F.add(e.children)}}(e,[]);return!(!n||null!==(t=l.ML.marks(e))&&void 0!==t&&t.insertMenu||e.selection&&l.y$.equals(e.selection.anchor.path,n)&&l.y$.equals(e.selection.focus.path,n))&&(l.YR.unsetNodes(e,"insertMenu",{at:n}),!0)}let _={"...":"…","-->":"→","->":"→","<-":"←","<--":"←","--":"–"},H=new Set,Z=new Set,j=null;function addMarkToChildren(e,t){let n=H.has(e);H.add(e);try{return t()}finally{n||H.delete(e)}}function setLinkForChildren(e,t){if(null!==j)return t();j=e;try{return t()}finally{j=null}}function addMarksToChildren(e,t){let n=new Set;for(let t of e)H.has(t)||n.add(t),H.add(t);try{return t()}finally{for(let e of n)H.delete(e)}}function getInlineNodes(e){let t={text:e};for(let e of H)Z.has(e)||(t[e]=!0);return null!==j?[{text:""},{type:"link",href:j,children:[t]},{text:""}]:[t]}function getAlignmentFromElement(e){let t=e.parentElement,n=null==t?void 0:t.getAttribute("data-align");if("center"===n||"end"===n)return n;if(e instanceof HTMLElement){let t=e.style.textAlign;if("center"===t)return"center";if("right"===t||"end"===t)return"end"}}let $={H1:1,H2:2,H3:3,H4:4,H5:5,H6:6},K={CODE:"code",DEL:"strikethrough",S:"strikethrough",STRIKE:"strikethrough",EM:"italic",I:"italic",STRONG:"bold",U:"underline",SUP:"superscript",SUB:"subscript",KBD:"keyboard"};function fixNodesForBlockChildren(e){if(!e.length)return[{text:""}];if(e.some(isBlock)){let t=[],n=[],flushInlines=()=>{n.length&&(t.push({type:"paragraph",children:n}),n=[])};for(let i of e){if(isBlock(i)){flushInlines(),t.push(i);continue}""!==l.NB.string(i).trim()&&n.push(i)}return flushInlines(),t}return e}let J={mdastExtensions:[L,R],extensions:[w,E()()]};function deserializeMarkdown(e){let t=B()(e,J),n=t.children;return 1===n.length&&"paragraph"===n[0].type&&(n=n[0].children),function deserializeChildren(e,t){let n=[];for(let i of e){let e=function(e,t){switch(e.type){case"blockquote":return[{type:"blockquote",children:deserializeChildren(e.children,t)}];case"link":return setLinkForChildren(e.url,()=>deserializeChildren(e.children,t));case"code":return[{type:"code",children:[{text:e.value}]}];case"paragraph":return[{type:"paragraph",children:deserializeChildren(e.children,t)}];case"heading":return[{type:"heading",level:e.depth,children:deserializeChildren(e.children,t)}];case"list":return[{type:e.ordered?"ordered-list":"unordered-list",children:deserializeChildren(e.children,t)}];case"listItem":return[{type:"list-item",children:deserializeChildren(e.children,t)}];case"thematicBreak":return[{type:"divider",children:[{text:""}]}];case"break":return getInlineNodes("\n");case"delete":return addMarkToChildren("strikethrough",()=>deserializeChildren(e.children,t));case"strong":return addMarkToChildren("bold",()=>deserializeChildren(e.children,t));case"emphasis":return addMarkToChildren("italic",()=>deserializeChildren(e.children,t));case"inlineCode":return addMarkToChildren("code",()=>getInlineNodes(e.value));case"text":return getInlineNodes(e.value)}return getInlineNodes(t.slice(e.position.start.offset,e.position.end.offset))}(i,t);e.length&&n.push(...e)}return n.length||n.push({text:""}),n}(n,e)}let U=/https?:\/\//;function insertFragmentButDifferent(e,t){let n=t[0];l.W_.isElement(n)&&l.ML.isBlock(e,n)?(0,h.insertNodesButReplaceIfSelectionIsAtEmptyParagraphOrHeading)(e,t):l.YR.insertFragment(e,t)}function createDocumentEditor(e,t,n){var i;return function(e){let{insertData:t,setFragmentData:n}=e;return e.setFragmentData=t=>{e.selection&&t.setData("application/x-keystone-document-editor","true"),n(t)},e.insertData=n=>{if("true"===n.getData("application/x-keystone-document-editor")){t(n);return}let i=l.ML.above(e,{match:t=>l.W_.isElement(t)&&l.ML.isBlock(e,t)});if((null==i?void 0:i[0].type)==="code"){let t=n.getData("text/plain");e.insertText(t);return}let r=n.getData("vscode-editor-data");if(r)try{let t=JSON.parse(r);if((null==t?void 0:t.mode)==="markdown"||(null==t?void 0:t.mode)==="mdx"){let t=n.getData("text/plain");if(t){let n=deserializeMarkdown(t);insertFragmentButDifferent(e,n);return}}}catch(e){console.log(e)}let o=n.getData("text/plain");if(U.test(o)&&(0,m.i)(o)&&e.selection&&!l.e6.isCollapsed(e.selection)&&l.ML.above(e,{match:t=>l.W_.isElement(t)&&l.ML.isBlock(e,t)&&!(l.W_.isElement(t.children[0])&&l.ML.isBlock(e,t.children[0]))})&&l.ML.nodes(e,{match:t=>l.W_.isElement(t)&&l.ML.isInline(e,t)}).next().done){l.YR.wrapNodes(e,{type:"link",href:o,children:[]},{split:!0});return}let s=n.getData("text/html");if(s){let t=function(e){let t=new DOMParser().parseFromString(e,"text/html");return fixNodesForBlockChildren(function deserializeNodes(e){let t=[];for(let n of e)t.push(...function(e){if(!(e instanceof globalThis.HTMLElement)){let t=e.textContent;return t?getInlineNodes(t):[]}if("BR"===e.nodeName)return getInlineNodes("\n");if("IMG"===e.nodeName){let t=e.getAttribute("alt");return getInlineNodes(null!=t?t:"")}if("HR"===e.nodeName)return[{type:"divider",children:[{text:""}]}];let t=function(e){let t=new Set,n=e.style,{nodeName:i}=e,r=K[i];r&&t.add(r);let{fontWeight:o,textDecoration:l,verticalAlign:s}=n;return"underline"===l?t.add("underline"):"line-through"===l&&t.add("strikethrough"),"SPAN"===i&&e.classList.contains("code")&&t.add("code"),"B"===i&&"normal"!==o?t.add("bold"):"string"==typeof o&&("bold"===o||"bolder"===o||"1000"===o||/^[5-9]\d{2}$/.test(o))&&t.add("bold"),"italic"===n.fontStyle&&t.add("italic"),"super"===s?t.add("superscript"):"sub"===s&&t.add("subscript"),t}(e);return e.classList.contains("listtype-quote")?(t.delete("italic"),addMarksToChildren(t,()=>[{type:"blockquote",children:fixNodesForBlockChildren(deserializeNodes(e.childNodes))}])):addMarksToChildren(t,()=>{let{nodeName:t}=e;if("A"===t){let t=e.getAttribute("href");if(t)return setLinkForChildren(t,()=>(function(e,t){let n=Z.has(e);Z.add(e);try{return t()}finally{n||Z.delete(e)}})("underline",()=>deserializeNodes(e.childNodes)))}if("PRE"===t&&e.textContent)return[{type:"code",children:[{text:e.textContent||""}]}];let n=deserializeNodes(e.childNodes),i=fixNodesForBlockChildren(n);if("LI"===t){let e;let t={type:"list-item-content",children:i.filter(t=>void 0!==e||"ordered-list"!==t.type&&"unordered-list"!==t.type||(e=t,!1))},n=e?[t,e]:[t];return[{type:"list-item",children:n}]}if("P"===t)return[{type:"paragraph",textAlign:getAlignmentFromElement(e),children:i}];let r=$[t];return"number"==typeof r?[{type:"heading",level:r,textAlign:getAlignmentFromElement(e),children:i}]:"BLOCKQUOTE"===t?[{type:"blockquote",children:i}]:"OL"===t?[{type:"ordered-list",children:i}]:"UL"===t?[{type:"unordered-list",children:i}]:"DIV"!==t||isBlock(i[0])?n:[{type:"paragraph",children:i}]})}(n));return t}(t.body.childNodes))}(s);insertFragmentButDifferent(e,t);return}if(o){let t=deserializeMarkdown(o);insertFragmentButDifferent(e,t);return}t(n)},e}(((i=function(e){let{normalizeNode:t}=e;return e.normalizeNode=([n,i])=>{if(!l.xv.isText(n)&&"link"!==n.type&&"relationship"!==n.type){let t=l.ML.isEditor(n)?"editor":n.type;if("string"!=typeof t||void 0===ei[t]){l.YR.unwrapNodes(e,{at:i});return}let r=ei[t];if("blocks"===r.kind&&0!==n.children.length&&n.children.every(t=>!(l.W_.isElement(t)&&l.ML.isBlock(e,t)))){l.YR.wrapNodes(e,{type:r.blockToWrapInlinesIn,children:[]},{at:i,match:t=>!(l.W_.isElement(t)&&l.ML.isBlock(e,t))});return}for(let[t,o]of n.children.entries()){let n=[...i,t];if("inlines"===r.kind){if(!l.xv.isText(o)&&!l.ML.isInline(e,o)&&"link"!==o.type&&"relationship"!==o.type){handleNodeInInvalidPosition(e,[o,n],i);return}}else{if(!(l.W_.isElement(o)&&l.ML.isBlock(e,o))||"link"===o.type||"relationship"===o.type){l.YR.wrapNodes(e,{type:r.blockToWrapInlinesIn,children:[]},{at:n});return}if(l.W_.isElement(o)&&l.ML.isBlock(e,o)&&!r.allowedChildren.has(o.type)){handleNodeInInvalidPosition(e,[o,n],i);return}}}}t([n,i])},e}(function(e,t,n){let{insertText:i,isInline:r,normalizeNode:o}=n;return n.isInline=e=>"link"===e.type||r(e),e.links&&(n.insertText=r=>{if(i(r),")"!==r||!n.selection)return;let o=l.ML.start(n,l.ML.above(n,{match:e=>l.W_.isElement(e)&&l.ML.isBlock(n,e)})[1]),s=l.ML.string(n,{anchor:n.selection.anchor,focus:o}),a=O.exec(s);if(!a)return;let d=getAncestorComponentChildFieldDocumentFeatures(n,e,t);if((null==d?void 0:d.documentFeatures.links)===!1)return;let[,c,u,p]=a;n.writeHistory("undos",{operations:[],selectionBefore:null});let f=0===a.index?o:(0,h.EditorAfterButIgnoringingPointsWithNoContent)(n,o,{distance:a.index}),m=(0,h.EditorAfterButIgnoringingPointsWithNoContent)(n,f,{distance:""===c?1:2}),g=(0,h.EditorAfterButIgnoringingPointsWithNoContent)(n,m,{distance:u.length});l.YR.delete(n,{at:{anchor:g,focus:n.selection.anchor}}),l.YR.delete(n,{at:{anchor:f,focus:m}}),l.YR.wrapNodes(n,{type:"link",href:p,children:[]},{at:{anchor:n.selection.anchor,focus:f},split:!0});let y=l.ML.next(n);y&&l.YR.select(n,y[1])}),n.normalizeNode=([e,t])=>{var i;if("link"===e.type){if(""===l.NB.string(e)){l.YR.unwrapNodes(n,{at:t});return}for(let[i,r]of e.children.entries())if("link"===r.type){l.YR.unwrapNodes(n,{at:[...t,i]});return}}if(void 0!==e.type&&er.has(e.type)){let r=null;for(let[o,s]of e.children.entries()){if("link"===s.type&&s.href===(null===(i=r)||void 0===i?void 0:i.node.href)){let e=[...t,r.index],i=[...t,o],a=[...e,r.node.children.length];for(let e=s.children.length-1;e>=0;e--){let t=[...i,e];l.YR.moveNodes(n,{at:t,to:a})}l.YR.removeNodes(n,{at:i});return}l.xv.isText(s)&&""===s.text||(r=null),"link"===s.type&&(r={index:o,node:s})}}o([e,t])},n}(e,t,function(e){let{insertBreak:t,normalizeNode:n,deleteBackward:i}=e;return e.deleteBackward=t=>{if(e.selection){let t=function(e){if(e.selection){let t=l.ML.above(e,{match:(0,h.nodeTypeMatcher)("list-item")}),n=l.ML.above(e,{match:isListNode});if(t&&n)return{isInside:!0,listItem:t,list:n}}return{isInside:!1}}(e);if(t.isInside&&l.e6.isCollapsed(e.selection)&&l.ML.isStart(e,e.selection.anchor,t.list[1])){l.YR.unwrapNodes(e,{match:isListNode,split:!0});return}}i(t)},e.insertBreak=()=>{let[n]=l.ML.nodes(e,{match:e=>"list-item"===e.type,mode:"lowest"});if(n&&""===l.NB.string(n[0])){l.YR.unwrapNodes(e,{match:isListNode,split:!0});return}t()},e.normalizeNode=t=>{let[i,r]=t;if(l.W_.isElement(i)||l.ML.isEditor(i)){let t=isListNode(i);for(let[n,s]of l.NB.children(e,r)){let a=s[s.length-1];if(isListNode(n)){var o;if((null===(o=i.children[s[s.length-1]+1])||void 0===o?void 0:o.type)===n.type){let t=l.y$.next(s);(0,h.moveChildren)(e,t,[...s,n.children.length]),l.YR.removeNodes(e,{at:t});return}if(t){let t=i.children[a-1];l.W_.isElement(t)?l.YR.moveNodes(e,{at:s,to:[...l.y$.previous(s),t.children.length-1]}):l.YR.unwrapNodes(e,{at:s});return}}if("list-item"===i.type&&"list-item-content"!==n.type&&0===a&&l.W_.isElement(n)&&l.ML.isBlock(e,n)){if(0!==r[r.length-1]){let t=l.NB.get(e,l.y$.previous(r));if(l.W_.isElement(t)){l.YR.moveNodes(e,{at:r,to:[...l.y$.previous(r),t.children.length]});return}}l.YR.unwrapNodes(e,{at:s});return}if("list-item"===i.type&&"list-item-content"===n.type&&0!==a){l.YR.splitNodes(e,{at:s});return}}}n(t)},e}(function(e){let{insertBreak:t}=e;return e.insertBreak=()=>{t();let n=l.ML.above(e,{match:e=>"heading"===e.type});if(!n||!e.selection||!l.e6.isCollapsed(e.selection))return;let i=n[1];if(l.E9.equals(l.ML.end(e,i),e.selection.anchor)){l.YR.unwrapNodes(e,{at:i});return}if(!l.y$.hasPrevious(i))return;let r=l.y$.previous(i),o=l.NB.get(e,r);"heading"===o.type&&1===o.children.length&&l.xv.isText(o.children[0])&&""===o.children[0].text&&l.YR.unwrapNodes(e,{at:r})},e}(function(e){let{isVoid:t,isInline:n}=e;return e.isVoid=e=>"relationship"===e.type||t(e),e.isInline=e=>"relationship"===e.type||n(e),e}(function(e){let{normalizeNode:t,apply:n,insertText:i}=e;return e.normalizeNode=([n,i])=>{if(l.xv.isText(n)&&n.insertMenu){if("/"!==n.text[0]){l.YR.unsetNodes(e,"insertMenu",{at:i});return}let t=/\s/.exec(n.text);if(t){l.YR.unsetNodes(e,"insertMenu",{at:{anchor:{path:i,offset:t.index},focus:l.ML.end(e,i)},match:l.xv.isText,split:!0});return}}l.ML.isEditor(e)&&removeInsertMenuMarkWhenOutsideOfSelection(e)||t([n,i])},e.apply=t=>{n(t),"set_selection"===t.type&&removeInsertMenuMarkWhenOutsideOfSelection(e)},e.insertText=t=>{if(i(t),e.selection&&"/"===t){let t=l.ML.start(e,l.ML.above(e,{match:t=>l.W_.isElement(t)&&l.ML.isBlock(e,t)})[1]),n=l.ML.before(e,e.selection.anchor,{unit:"character"});n&&(l.E9.equals(t,n)||0!==n.offset&&/\s/.test(l.NB.get(e,n.path).text[n.offset-1]))&&l.YR.setNodes(e,{insertMenu:!0},{at:{anchor:n,focus:e.selection.anchor},match:l.xv.isText,split:!0})}},e}(function(e,t,n,i){let r=(0,g.Z)(e=>(0,f.e)(t,e)),{normalizeNode:o,deleteBackward:s,insertBreak:a}=i;return i.deleteBackward=e=>{if(i.selection){let e=getAncestorComponentBlock(i);if(e.isInside&&l.e6.isCollapsed(i.selection)&&l.ML.isStart(i,i.selection.anchor,e.prop[1])&&0===e.prop[1][e.prop[1].length-1]){l.YR.unwrapNodes(i,{at:e.componentBlock[1]});return}}s(e)},i.insertBreak=()=>{let t=getAncestorComponentBlock(i);if(i.selection&&t.isInside){let{prop:[n,r],componentBlock:[o,s]}=t,d=r[r.length-1]===o.children.length-1;if("component-block-prop"===n.type){let[[e,r]]=l.ML.nodes(i,{match:e=>"paragraph"===e.type}),o=r[r.length-1]===n.children.length-1;if(""===l.NB.string(e)&&o){d?l.YR.moveNodes(i,{at:r,to:l.y$.next(t.componentBlock[1])}):(l.YR.move(i,{distance:1,unit:"line"}),l.YR.removeNodes(i,{at:r}));return}}if("component-inline-prop"===n.type){l.ML.withoutNormalizing(i,()=>{let t=e[o.component];if(void 0!==n.propPath&&void 0!==t){let e={kind:"object",fields:t.schema},c=(0,f.f)(e,n.propPath,o.props),u=[...c].reverse().findIndex(e=>"array"===e.kind);if(-1!==u){let e=c.length-1-u,t=c[e];(0,h.assert)("array"===t.kind);let p=(0,f.h)(o.props,n.propPath.slice(0,e));if(doesSchemaOnlyEverContainASingleChildField(t.element)){""===l.NB.string(n)&&p.length-1===n.propPath[e]?(l.YR.removeNodes(i,{at:r}),d?(l.YR.insertNodes(i,{type:"paragraph",children:[{text:""}]},{at:l.y$.next(s)}),l.YR.select(i,l.y$.next(s))):l.YR.move(i,{distance:1,unit:"line"})):a();return}}}l.YR.splitNodes(i,{always:!0});let c=l.y$.next(r);d?l.YR.moveNodes(i,{at:c,to:l.y$.next(s)}):((0,h.moveChildren)(i,c,[...l.y$.next(c),0]),l.YR.removeNodes(i,{at:c}))});return}}a()},i.normalizeNode=t=>{let[s,a]=t;if("component-inline-prop"===s.type&&!s.propPath&&(1!==s.children.length||!l.xv.isText(s.children[0])||""!==s.children[0].text)){l.YR.removeNodes(i,{at:a});return}if("component-block"===s.type){let t=e[s.component];if(t){let o={kind:"object",fields:t.schema},d=function addMissingFields(e,t){if("child"===t.kind||"form"===t.kind||"relationship"===t.kind)return e;if("conditional"===t.kind){let n=addMissingFields(e.value,t.values[e.discriminant.toString()]);return n===e.value?e:{discriminant:e.discriminant,value:n}}if("array"===t.kind){let n=e.map(e=>addMissingFields(e,t.element));return areArraysEqual(e,n)?e:n}if("object"===t.kind){let n=!1,i={};for(let[r,o]of Object.entries(t.fields)){let t=e[r];if(void 0===t){n=!0,i[r]=(0,f.g)(o);continue}let l=addMissingFields(t,o);l!==t&&(n=!0),i[r]=l}return n?i:e}(0,f.a)(t)}(s.props,o);if(d!==s.props){l.YR.setNodes(i,{props:d},{at:a});return}for(let[e,t]of function(e,t){let n=[];return(0,f.t)(e,t,(e,t,i)=>{"array"===e.kind&&doesSchemaOnlyEverContainASingleChildField(e.element)&&n.push([i,e])}),n}(o,s.props)){if(1===s.children.length&&"component-inline-prop"===s.children[0].type&&void 0===s.children[0].propPath)break;let n=[];for(let[t,i]of s.children.entries())if(("component-block-prop"===i.type||"component-inline-prop"===i.type)&&void 0!==i.propPath){let r=i.propPath.concat();for(;r.length&&"number"!=typeof r.pop(););areArraysEqual(e,r)&&n.push([t,i])}let r=(0,f.h)(s.props,e),d=(0,f.b)(r),c=new Set(d),u=new Set,p=[],m=[],getNewKey=()=>{let e=(0,f.j)();for(;c.has(e);)e=(0,f.j)();return e};for(let[,i]of n){let n=i.propPath[e.length];(0,h.assert)("number"==typeof n),r.length<=n||u.has(n)&&function(e){let t=e.children[0];return 1===e.children.length&&("component-inline-prop"===e.type&&void 0===t.type&&""===t.text||"component-block-prop"===e.type&&"paragraph"===t.type&&1===t.children.length&&void 0===t.children[0].type&&""===t.children[0].text)}(i)?(p.push((0,f.g)(t.element)),m.push(getNewKey())):(u.add(n),p.push(r[n]),m.push(u.has(n)?getNewKey():d[n]))}if((0,f.s)(p,m),!areArraysEqual(r,p)){let t=(0,f.r)(o,s.props,p,e);for(let[r,[o,s]]of(l.YR.setNodes(i,{props:t},{at:a}),n.entries())){let t=[...s.propPath];t[e.length]=r,l.YR.setNodes(i,{propPath:t},{at:[...a,o]})}return}}let c=new Map((0,f.i)(s.props,t.schema).map(e=>[JSON.stringify(e.path),e.options.kind]));if(s.children.forEach(e=>{(0,h.assert)("component-block-prop"===e.type||"component-inline-prop"===e.type),c.delete(JSON.stringify(e.propPath))}),c.size){l.YR.insertNodes(i,[...c].map(([e,t])=>({type:`component-${t}-prop`,propPath:e?JSON.parse(e):e,children:[{text:""}]})),{at:[...a,s.children.length]});return}let u=new Set,p={};for(let[t,o]of((0,f.i)(s.props,e[s.component].schema).forEach((e,t)=>{p[JSON.stringify(e.path)]={options:e.options,index:t}}),s.children.entries())){if("component-inline-prop"!==o.type&&"component-block-prop"!==o.type)continue;let e=[...a,t],s=JSON.stringify(o.propPath);if(void 0===p[s]||u.has(s)){l.YR.removeNodes(i,{at:e});return}u.add(s);let d=p[s],c=d.index;if(t!==c){l.YR.moveNodes(i,{at:e,to:[...a,c]});return}let h=`component-${d.options.kind}-prop`;if(o.type!==h){l.YR.setNodes(i,{type:h},{at:e});return}let f=r(d.options);if(function normalizeNodeWithinComponentProp([e,t],n,i,r){let o=I.get(i);if(o||(o=new WeakSet,I.set(i,o)),o.has(e))return!1;let s=!1;if("inherit"!==i.inlineMarks&&l.xv.isText(e)&&(s=normalizeTextBasedOnInlineMarksAndSoftBreaks([e,t],n,i.inlineMarks,i.softBreaks)),l.W_.isElement(e)){let o=e.children.map((e,o)=>normalizeNodeWithinComponentProp([e,[...t,o]],n,i,r)).some(e=>e);s="block"===i.kind?normalizeElementBasedOnDocumentFeatures([e,t],n,i.documentFeatures,r)||o:normalizeInlineBasedOnLinksAndRelationships([e,t],n,i.documentFeatures.links,i.documentFeatures.relationships,r)}return!1===s&&o.add(e),s}([o,e],i,f,n))return}}}o(t)},i}(t,e,n,function(e){let{normalizeNode:t}=e;return e.normalizeNode=n=>{let[i,r]=n;if(l.ML.isEditor(i)){let t=i.children[i.children.length-1];if((null==t?void 0:t.type)!=="paragraph"){l.YR.insertNodes(e,paragraphElement(),{at:[...r,i.children.length]});return}}t(n)},e}(function(e){let{insertText:t}=e;return e.insertText=n=>{if(t(n)," "===n&&e.selection&&l.e6.isCollapsed(e.selection)){let t=e.selection.anchor,n=l.ML.above(e,{match:t=>l.W_.isElement(t)&&l.ML.isBlock(e,t)});n&&Object.keys(_).forEach(i=>{let r=l.ML.before(e,t,{unit:"character",distance:i.length+1});if(r&&l.y$.isDescendant(r.path,n[1])){let n={anchor:t,focus:r},o=l.ML.string(e,n);o.slice(0,i.length)===i&&(e.writeHistory("undos",{operations:[],selectionBefore:null}),l.YR.select(e,n),e.insertText(_[i]+" "))}})}},e}(function(e){let{isVoid:t}=e;return e.isVoid=e=>"divider"===e.type||t(e),e}(function(e){let{normalizeNode:t,deleteBackward:n}=e;return e.deleteBackward=t=>{if(e.selection&&l.e6.isCollapsed(e.selection)&&0===e.selection.anchor.offset){let[t,n]=l.ML.above(e,{match:e=>"layout-area"===e.type})||[e,[]];if("layout-area"===t.type&&l.E9.equals(l.ML.start(e,n),e.selection.anchor))return}n(t)},e.normalizeNode=n=>{let[i,r]=n;if(l.W_.isElement(i)&&"layout"===i.type){if(void 0===i.layout){l.YR.unwrapNodes(e,{at:r});return}if(i.children.length<i.layout.length){l.YR.insertNodes(e,Array.from({length:i.layout.length-i.children.length}).map(()=>({type:"layout-area",children:[paragraphElement()]})),{at:[...r,i.children.length]});return}if(i.children.length>i.layout.length){Array.from({length:i.children.length-i.layout.length}).map((e,t)=>t).reverse().forEach(t=>{let n=[...r,t+i.layout.length],o=i.children[t+i.layout.length];(0,h.moveChildren)(e,n,[...r,i.layout.length-1,i.children[i.layout.length-1].children.length],e=>"paragraph"!==e.type||""!==l.NB.string(o)),l.YR.removeNodes(e,{at:n})});return}}t(n)},e}(function(e,t,n){let{insertText:i,insertBreak:r}=n;n.insertBreak=()=>{r();let e=l.ML.marks(n);if(!e||!n.selection)return;let t=l.ML.above(n,{match:e=>l.W_.isElement(e)&&l.ML.isBlock(n,e)});if(!t)return;let i=(0,h.EditorAfterButIgnoringingPointsWithNoContent)(n,n.selection.anchor),o=Object.keys(e);if(!i||!l.y$.isDescendant(i.path,t[1])){for(let e of o)n.removeMark(e);return}let s=l.NB.get(n,i.path);for(let e of o)s[e]||n.removeMark(e)};let o={},s=e.formatting.inlineMarks;return Object.keys(W).forEach(e=>{s[e]&&(o[e]=W[e])}),0===Object.keys(o).length||(n.insertText=r=>{if(i(r),n.selection&&l.e6.isCollapsed(n.selection)){for(let[i,s]of Object.entries(o))for(let o of s)if(r===o[o.length-1]){let r=function(e){return l.ML.start(e,l.ML.above(e,{match:t=>l.W_.isElement(t)&&l.ML.isBlock(e,t)})[1])}(n),s=l.ML.string(n,{anchor:n.selection.anchor,focus:r}),a=/\s/.test(s.slice(-o.length-1,-o.length)),d=o===s.slice(-o.length);if(a||!d)continue;let c=s.slice(0,-o.length-1);for(let[s]of[...c].reverse().entries()){let a=c.slice(s,s+o.length);if(a!==o)continue;let d=0===s?r:(0,h.EditorAfterButIgnoringingPointsWithNoContent)(n,r,{distance:s}),u=l.ML.after(n,d,{distance:o.length});if(0!==s&&!/\s/.test(l.ML.string(n,{anchor:l.ML.before(n,d,{unit:"character"}),focus:d})))continue;let p=l.ML.string(n,{anchor:u,focus:n.selection.anchor}).slice(0,-o.length);if(""===p||/\s/.test(p[0])||"italic"===i&&("_"===p[0]||"*"===p[0]))continue;let f=getAncestorComponentChildFieldDocumentFeatures(n,e,t);if(!f||"inherit"===f.inlineMarks||!1!==f.inlineMarks[i]){!function(e,t,n,i){e.writeHistory("undos",{operations:[],selectionBefore:null});let r=l.ML.pointRef(e,i);l.YR.delete(e,{at:e.selection.anchor,distance:n.length,reverse:!0}),l.YR.delete(e,{at:i,distance:n.length}),l.YR.setNodes(e,{[t]:!0},{match:l.xv.isText,split:!0,at:{anchor:r.unref(),focus:e.selection.anchor}}),e.removeMark(t)}(n,i,o,d);return}}}}}),n}(e,t,function(e){let{insertBreak:t,normalizeNode:n}=e;return e.insertBreak=()=>{let[n,i]=l.ML.above(e,{match:t=>l.W_.isElement(t)&&l.ML.isBlock(e,t)})||[e,[]];if("code"===n.type&&l.xv.isText(n.children[0])){let r=n.children[0].text;if("\n"===r[r.length-1]&&e.selection&&l.e6.isCollapsed(e.selection)&&l.E9.equals(l.ML.end(e,i),e.selection.anchor)){t(),l.YR.setNodes(e,{type:"paragraph",children:[]}),l.YR.delete(e,{distance:1,at:{path:[...i,0],offset:r.length-1}});return}e.insertText("\n");return}t()},e.normalizeNode=([t,i])=>{if("code"===t.type&&l.W_.isElement(t))for(let[n,r]of t.children.entries()){if(!l.xv.isText(r)){e.isVoid(r)?l.YR.removeNodes(e,{at:[...i,n]}):l.YR.unwrapNodes(e,{at:[...i,n]});return}let t=Object.keys(r).filter(e=>"text"!==e);if(t.length){l.YR.unsetNodes(e,t,{at:[...i,n]});return}}n([t,i])},e}(function(e,t,n){let{insertText:i}=n,r=Object.create(null),o={...e,relationships:!0},addShortcut=(e,t,n,i="paragraph")=>{if(!n(o))return;let l=e[e.length-1];r[l]||(r[l]=Object.create(null)),r[l][e]={insert:t,type:i,shouldBeEnabledInComponentBlock:n}};return addShortcut("1. ",()=>{l.YR.wrapNodes(n,{type:"ordered-list",children:[]},{match:e=>l.W_.isElement(e)&&l.ML.isBlock(n,e)})},e=>e.formatting.listTypes.ordered),addShortcut("- ",()=>{l.YR.wrapNodes(n,{type:"unordered-list",children:[]},{match:e=>l.W_.isElement(e)&&l.ML.isBlock(n,e)})},e=>e.formatting.listTypes.unordered),addShortcut("* ",()=>{l.YR.wrapNodes(n,{type:"unordered-list",children:[]},{match:e=>l.W_.isElement(e)&&l.ML.isBlock(n,e)})},e=>e.formatting.listTypes.unordered),e.formatting.headingLevels.forEach(e=>{addShortcut("#".repeat(e)+" ",()=>{l.YR.setNodes(n,{type:"heading",level:e},{match:e=>"paragraph"===e.type||"heading"===e.type})},t=>t.formatting.headingLevels.includes(e),"heading-or-paragraph")}),addShortcut("> ",()=>{l.YR.wrapNodes(n,{type:"blockquote",children:[]},{match:e=>"paragraph"===e.type})},e=>e.formatting.blockTypes.blockquote),addShortcut("```",()=>{l.YR.wrapNodes(n,{type:"code",children:[]},{match:e=>"paragraph"===e.type})},e=>e.formatting.blockTypes.code),addShortcut("---",()=>{insertDivider(n)},e=>e.dividers),n.insertText=o=>{i(o);let s=r[o];if(s&&n.selection&&l.e6.isCollapsed(n.selection)){let{anchor:i}=n.selection,r=l.ML.above(n,{match:e=>l.W_.isElement(e)&&l.ML.isBlock(n,e)});if(!r||"paragraph"!==r[0].type&&"heading"!==r[0].type)return;let o=l.ML.start(n,r[1]),a={anchor:i,focus:o},d=l.ML.string(n,a),c=s[d];if(!c||"paragraph"===c.type&&"paragraph"!==r[0].type)return;let u=getAncestorComponentChildFieldDocumentFeatures(n,e,t);if(u&&("inline"===u.kind||!c.shouldBeEnabledInComponentBlock(u.documentFeatures)))return;n.writeHistory("undos",{operations:[],selectionBefore:null}),l.YR.select(n,a),l.YR.delete(n),c.insert()}},n}(e,t,function(e){let{insertBreak:t,deleteBackward:n}=e;return e.deleteBackward=t=>{if(e.selection){let t=getDirectBlockquoteParentFromSelection(e);if(t.isInside&&l.e6.isCollapsed(e.selection)&&0===e.selection.anchor.offset&&0===e.selection.anchor.path[e.selection.anchor.path.length-2]){l.YR.unwrapNodes(e,{match:e=>"blockquote"===e.type,split:!0});return}}n(t)},e.insertBreak=()=>{let n=getDirectBlockquoteParentFromSelection(e);if(e.selection&&n.isInside){let[t,i]=l.ML.node(e,e.selection);if(l.y$.isDescendant(i,n.path)&&""===l.NB.string(t)){l.YR.unwrapNodes(e,{match:e=>"blockquote"===e.type,split:!0});return}}t()},e}(function(e,t,n){let{normalizeNode:i}=n,r={...e,relationships:!0};return n.normalizeNode=([o,s])=>{l.xv.isText(o)?normalizeTextBasedOnInlineMarksAndSoftBreaks([o,s],n,e.formatting.inlineMarks,e.formatting.softBreaks):l.W_.isElement(o)&&normalizeElementBasedOnDocumentFeatures([o,s],n,r,t),i([o,s])},n}(e,n,(0,a.VC)((0,s.BU)((0,l.Jh)()))))))))))))))))))).insertSoftBreak=()=>{l.YR.insertText(i,"\n")},i))}let V=["lower-roman","decimal","lower-alpha"],Q=["square","disc","circle"],G={flex:1},X=10;for(;X--;){let e=Array.from({length:X});e.length&&(G[e.map(()=>"ol").join(" ")]={listStyle:V[X%3]},G[e.map(()=>"ul").join(" ")]={listStyle:Q[X%3]})}let ee=["paragraph","code","heading","ordered-list","unordered-list","divider"],et=[...ee,"blockquote"],en=[...et,"component-block"];function blockContainer(e){return{kind:"blocks",allowedChildren:new Set(e.allowedChildren),blockToWrapInlinesIn:e.allowedChildren[0],invalidPositionHandleMode:e.invalidPositionHandleMode}}function inlineContainer(e){return{kind:"inlines",invalidPositionHandleMode:e.invalidPositionHandleMode}}let ei={editor:blockContainer({allowedChildren:[...en,"layout"],invalidPositionHandleMode:"move"}),layout:blockContainer({allowedChildren:["layout-area"],invalidPositionHandleMode:"move"}),"layout-area":blockContainer({allowedChildren:en,invalidPositionHandleMode:"unwrap"}),blockquote:blockContainer({allowedChildren:ee,invalidPositionHandleMode:"move"}),paragraph:inlineContainer({invalidPositionHandleMode:"unwrap"}),code:inlineContainer({invalidPositionHandleMode:"move"}),divider:inlineContainer({invalidPositionHandleMode:"move"}),heading:inlineContainer({invalidPositionHandleMode:"unwrap"}),"component-block":blockContainer({allowedChildren:["component-block-prop","component-inline-prop"],invalidPositionHandleMode:"move"}),"component-inline-prop":inlineContainer({invalidPositionHandleMode:"unwrap"}),"component-block-prop":blockContainer({allowedChildren:et,invalidPositionHandleMode:"unwrap"}),"ordered-list":blockContainer({allowedChildren:["list-item"],invalidPositionHandleMode:"move"}),"unordered-list":blockContainer({allowedChildren:["list-item"],invalidPositionHandleMode:"move"}),"list-item":blockContainer({allowedChildren:["list-item-content","ordered-list","unordered-list"],invalidPositionHandleMode:"unwrap"}),"list-item-content":inlineContainer({invalidPositionHandleMode:"unwrap"})},er=new Set(Object.entries(ei).filter(([,e])=>"inlines"===e.kind).map(([e])=>e)),eo=new Set(Object.keys(ei).filter(e=>"editor"!==e));function isBlock(e){return eo.has(e.type)}function handleNodeInInvalidPosition(e,[t,n],i){let r=t.type,o=ei[r],s=l.NB.get(e,i),a=l.ML.isEditor(s)?"editor":s.type,d=ei[a];if(!o||"unwrap"===o.invalidPositionHandleMode){if("blocks"===d.kind&&d.blockToWrapInlinesIn){l.YR.setNodes(e,{type:d.blockToWrapInlinesIn,...Object.fromEntries(Object.keys(t).filter(e=>"type"!==e&&"children"!==e).map(e=>[e,null]))},{at:n});return}l.YR.unwrapNodes(e,{at:n});return}let c=ei[s.type||"editor"];if((null==c?void 0:c.kind)==="blocks"&&c.allowedChildren.has(r)){0===i.length?l.YR.moveNodes(e,{at:n,to:[n[0]+1]}):l.YR.moveNodes(e,{at:n,to:l.y$.next(i)});return}if(l.ML.isEditor(s)){l.YR.moveNodes(e,{at:n,to:[n[0]+1]}),l.YR.unwrapNodes(e,{at:[n[0]+1]});return}handleNodeInInvalidPosition(e,[t,n],i.slice(0,-1))}}}]);